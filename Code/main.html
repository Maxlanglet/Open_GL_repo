<!DOCTYPE html>
<html>
<head>
</head>
<body>
<canvas id="webgl_canvas" width="1280" height="720"></canvas>
<div id="fps"></div>
<div id="camera_mat"></div>
<div id="proj_mat"></div>

<script src="../Utilities/gl-matrix-min.js"></script>
<script language="javascript" type="text/javascript" src="../Utilities/cam.js"></script>
<script language="javascript" type="text/javascript" src="../Utilities/shaders.js"></script>
<script language="javascript" type="text/javascript" src="../Utilities/textures.js"></script>
<script language="javascript" type="text/javascript" src="../Utilities/objects_02.js"></script>
<script language="javascript" type="text/javascript" src="../Shaders/wall.js"></script>
<script language="javascript" type="text/javascript" src="../Shaders/seat_all.js"></script>
<script language="javascript" type="text/javascript" src="../Utilities/vacuum.js"></script>
<script>
    async function main() {
        // Boilerplate code
        const canvas = document.getElementById('webgl_canvas');
        c_width = canvas.width
        c_height = canvas.height
        const gl = canvas.getContext('webgl');

        // Enable tests for better rendering
        gl.enable(gl.DEPTH_TEST);
        //gl.enable(gl.CULL_FACE); // cull hidden faces behind normals!

        //Load the object

        var vac = await load_obj('../Objects/vac.obj');
        var vac_obj = await make_object(gl, vac)
        var vac_shader_comps = await load_shader_wall(gl);
        //Define what needed

        var vac_shader = make_shader(gl, (vac_shader_comps).shader_v,(vac_shader_comps).shader_f);

        //Camera parameters
        position = glMatrix.vec3.fromValues(1, 0, -6.0)
        placeholder = glMatrix.vec3.fromValues(1, 0, -6.0)


        var vac_pos = glMatrix.mat3.add(placeholder,placeholder,glMatrix.vec3.fromValues(-0.5,0.0,2.0));
        var vacuum = await make_vacuum(vac, vac_obj, vac_shader_comps, vac_shader, placeholder, gl);


        up = glMatrix.vec3.fromValues(0.0, 1.0, 0.0)
        yaw = -90.0
        pitch = 0.0
        var camera = make_camera(canvas, position, up, yaw, pitch, vacuum);
        var projection = camera.get_projection(45.0, c_width / c_height, 0.01, 100.0);


        //place vacuum
        vacuum.translate(vac_pos);

        var deltaTime = 0;

        function animate(time) {
            deltaTime += 0.005;
            camera.update(deltaTime);
            //Draw loop
            gl.clearColor(0.5, 0.5, 0.5, 1);
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

            view = camera.get_view_matrix();

            //Shaders


            vacuum.draw(view, projection);

            placeholder = glMatrix.mat4.copy(placeholder, position);

            // console.log("placeholder" ,placeholder)
            // console.log("position", position)
            // vac_shader.model = glMatrix.mat4.translate(vac_obj.model,vac_obj.model,glMatrix.mat3.add(placeholder,placeholder,glMatrix.vec3.fromValues(-0.5,0.0,2.0)));

            fps(time);
            window.requestAnimationFrame(animate); // While(True) loop!
        }

        var prev = 0
        const fpsElem = document.querySelector("#fps");
        function fps(now) {
            now *= 0.001;
            const deltaTime = now - prev;
            prev = now;
            const fps = 1 / deltaTime;
            fpsElem.textContent = 'FPS: ' + fps.toFixed(1);
            return fps;
        }

        animate(0);
    };
    main();
</script>
</body>
</html>


